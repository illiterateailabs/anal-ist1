# analyst-droid-one ‚Äì TODO / Improvement Plan
_Date created: **2025-06-23**_

This file captures today‚Äôs full-stack audit plus a concrete, prioritised improvement roadmap. All open items are classified by theme with ‚úì/‚ö†Ô∏è/üö´ reflecting current gaps.

---

## 0. Snapshot ‚Äì What‚Äôs working (‚úì)
* FastAPI + Next 14 stack runs end-to-end; >30 integration tests pass.
* Conversation persistence (Alembic 003) operational.
* Metrics (`/metrics`) + Sentry wired.
* Graph-Aware RAG service, multi-LLM/Gemini integration, CrewAI tooling.
* Tools for GNN, whale-tracking, anomaly detection all present.

## 1. Observability & Ops
| Priority | Task |
|----------|------|
| P0 | ~~Wire OpenTelemetry (FastAPI & Python stdlib) ‚Üí OTLP ‚Üí Grafana Tempo~~ ‚úì *(commit `e26a762` wired OTEL + automatic instrumentation)* |
| P0 | Create Grafana dashboards: API p99 latency, provider spend, queue depth |
| P1 | Replace brute-force vector search with Redis 7 `HNSW` index + `FT.SEARCH` |
| P1 | Add Prometheus alert rules for 90 % budget, circuit OPEN state |
| P2 | Ensure metrics env vars templated in `docker-compose*.yml` |

## 2. Back-Pressure & Cost Control
* ‚úì **BackpressureMiddleware mounted** in `backend/main.py` *(done 2025-06-23)*.
* ‚úì **providers/registry.yaml** populated with `budget`, `rate_limits`, `cost_rules` *(commit `e26a762`)*.
* ‚úì **Emit `external_api_credit_used_total` from Gemini & e2b clients** *(commit `4b6c227` adds full cost-tracking to Gemini & all external clients)*.
* Write emergency budget protection unit test.

## 3. Security Hardening
1. Migrate to secure access/refresh cookies; rotate refresh tokens; enable blacklist.
2. Add SlowAPI rate-limit middleware to critical endpoints.
3. Review CORS: derive allowed origins from `.env` not hardcoded.

## 4. Scalability & Jobs
| Status | Task | Notes |
|--------|------|-------|
| ‚úì *(commit `a7a59fe`)* | Introduce Celery + Redis background job system | Offloads image/GNN heavy tools & SIM graph ingestion |
| ‚úì *(commit `a7a59fe`)* | Convert `sim_graph_job` & code-gen tasks to Celery queue | Now dispatched to `data_ingestion` / `analysis` queues |
| ‚úì *(commit `a7a59fe`)* | Worker health-check & Prometheus metrics | `/health/workers` endpoint + queue depth gauges |

## 5. Graph Roadmap
* ~~Finish **Explain-with-Cypher**: intercept generated Cypher, store in EvidenceBundle~~ ‚úì *(commit `a833029` integrates tracking into GraphQueryTool)*
* Implement Graph Ideas backlog:
  * DeFi Protocol Map (Idea #2)
  * Token Ecosystem Network (Idea #4)
* Add Redis path-cache for common wallet pairs.

## 6. Developer Experience
* ~~Pre-commit for `frontend` (eslint + type-check)~~ ‚úì *(hook IDs `eslint-frontend`, `prettier-frontend`, `tsc-frontend` added to pre-commit config)*
* Auto-generate typed OpenAPI client for React Query.
* Playwright e2e: login ‚Üí chat ‚Üí graph flow; add to CI matrix.
* Remove dead in-memory convo store comments in `chat.py`.

## 7. Deployment / DevOps
* Produce Helm chart (backend, frontend, PG, Neo4j, Redis).
* Add GitHub Actions `deploy.yaml` gated on main.
* Kustomize overlays for prod/staging.

## 8. Quick Wins (within 1 day)
- [x] Swap brute-force vector loop to Redis vector search ‚Äì implemented via Redis **Vector Search HNSW** index (commit `eb6d80d`).
- [x] Mount `BackpressureMiddleware` ‚Äì middleware now active for all routes (see same commit).
- [x] Update `Next.js` Dockerfile `NODE_ENV=production` ‚Äì confirmed in multi-stage Dockerfile.
- [x] Rename `DEBUG` env in codebase to `FASTAPI_DEBUG` (commit `3d667d9`) to avoid accidental prod debug.

## 9. Next Steps
1. Confirm backlog & priorities with stakeholders.
2. Create `phase-4` branch; scaffold Celery & OTEL.
3. Spin up staging via `docker-compose.prod.yml` + Prom/Grafana for baseline.
4. Break each section into GitHub issues & assign v1.9.0-beta / v2.0.0.

---

## 10. Dune SIM + LLM Use-Case Roadmap (Phase 5)

Each item below is a **feature-level epic**.  We track *design ‚Üí PoC ‚Üí production* in three steps.

| # | Use-Case | Action Plan |
|---|----------|------------|
| 1 | AI-Driven ‚ÄúWhat-If‚Äù DeFi Stress-Testing | ‚ë† Design stress-scenario prompt templates. ‚ë° Build Monte-Carlo simulator micro-service reading SIM TVL/liquidity metrics. ‚ë¢ Expose `/stress-test` API + Grafana panel. |
| 2 | Automated Regulatory Compliance Reports | ‚ë† Define AML/whale/red-flag rules in YAML. ‚ë° Create `ComplianceReportTool` generating PDF/JSON. ‚ë¢ Nightly Celery schedule + email webhook. |
| 3 | Dynamic Arbitrage Opportunity Engine | ‚ë† Build price aggregator (SIM + on-chain DEX APIs). ‚ë° RAG prompt to generate arbitrage strategy + risk. ‚ë¢ Optional code-gen ‚Üí E2B sandbox back-test. |
| 4 | AI-Generated DeFi Protocol Blueprints | ‚ë† Mine historical protocol KPIs via SIM. ‚ë° LLM template to propose new features. ‚ë¢ Review loop (HITL) before committing to docs. |
| 5 | Sentiment-Driven Data Analysis | ‚ë† Integrate social-sentiment feed (Twitter/Reddit). ‚ë° Correlate with SIM withdrawal metrics. ‚ë¢ Alert pipeline + dashboard widget. |
| 6 | Self-Improving Data Dashboards | ‚ë† Instrument dashboard usage events. ‚ë° LLM ranks top queries, updates config. ‚ë¢ Push delta via Grafana API. |
| 7 | Fraud Detection via Anomaly Hunting | ‚ë† Extend GNN anomaly tool with SIM heuristics. ‚ë° Nightly scan task ‚Üí Neo4j flag nodes. ‚ë¢ Webhook alerts + EvidenceBundle export. |
| 8 | AI-Powered DeFi Tax Optimizer | ‚ë† Map SIM tx classifications to tax rules. ‚ë° LLM summarises harvest strategies. ‚ë¢ CSV/JSON export for accountants. |
| 9 | Decentralized Forecasting Markets | ‚ë† Create prediction-market schema in Neo4j. ‚ë° LLM crafts question + probability curves. ‚ë¢ Optional on-chain deployment via oracle. |
| 10 | Ethical AI for DAO Governance | ‚ë† Analyse SIM governance vote data. ‚ë° LLM suggests policy constraints. ‚ë¢ Auto-draft DAO proposals. |
| 11 | Cross-Chain Liquidity Migration Predictor | ‚ë† Parse bridge flows from SIM. ‚ë° Time-series model + LLM narrative. ‚ë¢ Real-time dashboard & alert. |
| 12 | AI-Driven DeFi Security Audits | ‚ë† Curate exploit pattern library. ‚ë° LLM + graph query detect matches. ‚ë¢ Generate audit report PDF. |
| 13 | Dynamic Staking Strategy Generator | ‚ë† Ingest staking APY feed. ‚ë° Optimiser agent evaluates gas vs APY. ‚ë¢ Strategy JSON + UI wizard. |
| 14 | Automated DeFi Whitepaper Generator | ‚ë† Gather protocol KPIs. ‚ë° LLM drafts sections (tokenomics, risk). ‚ë¢ HITL review ‚Üí export Markdown/PDF. |
| 15 | Real-Time Market Manipulation Detector | ‚ë† Stream DEX trades via SIM. ‚ë° Statistical outlier + LLM explanation. ‚ë¢ Alert + mitigation suggestion. |
| 16 | AI-Enhanced DeFi Education Platform | ‚ë† Convert SIM metrics ‚Üí tutorial notebooks. ‚ë° LLM generates step-by-step guides. ‚ë¢ Publish via Docs site. |
| 17 | Self-Healing DeFi Protocols | ‚ë† Monitor health metrics (slippage, TVL). ‚ë° LLM proposes param changes. ‚ë¢ Auto-create governance PR. |
| 18 | Cross-Chain Sybil Attack Detector | ‚ë† Correlate address behaviour across chains. ‚ë° GNN/Sybil algorithm + LLM summary. ‚ë¢ Flag nodes in Neo4j, export evidence. |
| 19 | AI-Driven DeFi Insurance Underwriting | ‚ë† Risk model ingest loss history. ‚ë° LLM price premium per protocol. ‚ë¢ Underwriting API endpoint. |
| 20 | Ethical DeFi Impact Reports | ‚ë† Join SIM data with ESG metrics. ‚ë° LLM drafts sustainability report. ‚ë¢ PDF export + investor dashboard. |
| 21 | Automated Arbitrage Bot Code Generation | ‚ë† Detect price spreads (SIM). ‚ë° LLM emits Python/Solidity bot code. ‚ë¢ E2B sandbox back-test & risk page. |
| 22 | DAO Proposal Auto-Writer | ‚ë† Mine governance data for success patterns. ‚ë° LLM drafts proposal with probability score. ‚ë¢ Push to DAO via webhook. |
| 23 | Gas Optimization Playbook | ‚ë† Analyse SIM gas trends. ‚ë° LLM recommends optimal timing. ‚ë¢ UI calendar export + alert. |
| 24 | AI-Generated DeFi Crisis Playbooks | ‚ë† Scenario simulator for extreme events. ‚ë° LLM generates contingency SOP. ‚ë¢ Store in knowledge-base. |
| 25 | Cross-Protocol Synergy Identifier | ‚ë† Correlate SIM metrics across protocols. ‚ë° Graph algorithm detects synergy. ‚ë¢ LLM suggests partnership proposal. |

_Responsible: Daniel Thorp ‚Ä¢ Generated by Factory Droid on 2025-06-23_.
